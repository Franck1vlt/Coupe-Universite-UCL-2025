<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coupe Universitaire - Football</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Dans styles.css, pensez à définir par exemple : 
       .phase-content { display: flex; } 
       .hidden { display: none !important; }
  -->
  <style>
    .correction-button {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: #f44336;
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .correction-button:hover {
      transform: scale(1.1);
      background-color: #d32f2f;
    }

    .match.terminé {
      cursor: pointer;
    }

    .match.terminé:hover {
      border: 2px solid #f44336;
    }
    
    /* Style pour l'indicateur en direct */
    .live-indicator {
      position: fixed;
      top: 10px;
      left: 10px;
      background-color: #f44336;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      animation: pulse 1.5s infinite;
      z-index: 1000;
      display: none;
      font-weight: bold;
    }

    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }
  </style>
</head>
<body>
  <!-- Ajouter un indicateur pour les mises à jour en direct -->
  <div class="live-indicator" id="liveIndicator">Match en direct</div>
  <button id="correctionMode" class="correction-button" onclick="toggleCorrectionMode()">✏️</button>
  <div class="background-lines"></div>
  <div class="container">
    <header>
      <div class="phase-selector">
        <select id="phaseSelect" class="phase-select">
          <option value="qualification">Qualifications</option>
          <option value="final" selected>Phase Finale</option>
          <option value="classification">Matchs de Classement</option>
          <option value="ranking">Classement Final</option>
        </select>
      </div>
      <h1>Football</h1>
      <div class="subtitle">Phase à élimination directe</div>
    </header>
    
    <div class="tournament-container">
      <!-- SECTION QUALIFICATIONS -->
      <div class="bracket phase-content" id="qualification-phase">
        <div class="round qualification-round">
          <div class="round-title">Qualifications</div>
          <!-- Match 1 -->
          <div class="match-wrapper">
            <div class="match" data-match-id="1" data-match-type="qualification">
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>FMMS</div>
                <div class="score">5</div>
              </div>
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>USCHOOL</div>
                <div class="score">0</div>
              </div>
            </div>
            <div class="connector right"></div>
          </div>
          <!-- Match 2 -->
          <div class="match-wrapper">
            <div class="match" data-match-id="2" data-match-type="qualification">
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>ESPAS-ESTICE</div>
                <div class="score">1</div>
              </div>
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>FLSH</div>
                <div class="score">0</div>
              </div>
            </div>
            <div class="connector right"></div>
          </div>
          <!-- Match 3 -->
          <div class="match-wrapper">
            <div class="match" data-match-id="3" data-match-type="qualification">
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>JUNIA</div>
                <div class="score">1</div>
              </div>
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>ICAM</div>
                <div class="score">5</div>
              </div>
            </div>
            <div class="connector right"></div>
          </div>
          <!-- Match 4 -->
          <div class="match-wrapper">
            <div class="match" data-match-id="4" data-match-type="qualification">
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>ESPOL</div>
                <div class="score">14</div>
              </div>
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>ESSLIL</div>
                <div class="score">0</div>
              </div>
            </div>
            <div class="connector right"></div>
          </div>
        </div>
      </div>

      <!-- SECTION PHASE FINALE -->
      <div class="bracket phase-content" id="final-phase">
        <!-- Quarts de finale -->
        <div class="round">
          <div class="round-title">Quarts de finale</div>
          <div class="match-wrapper">
            <div class="match" data-match-id="5" data-match-type="quarterfinal" data-position="1">
              <div class="team" data-team-id="1">
                <div class="team-name"><div class="team-logo"></div>ICAM</div>
                <div class="score">-</div>
              </div>
              <div class="team" data-team-id="2">
                <div class="team-name"><div class="team-logo"></div>FMMS</div>
                <div class="score">-</div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
            </div>
            <div class="connector top"></div>
          </div>
          <div class="match-wrapper">
            <div class="match" data-match-id="6" data-match-type="quarterfinal" data-position="2">
              <div class="team" data-team-id="3">
                <div class="team-name"><div class="team-logo"></div>IKPO</div>
                <div class="score">-</div>
              </div>
              <div class="team" data-team-id="4">
                <div class="team-name"><div class="team-logo"></div>FGES</div>
                <div class="score">-</div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
            </div>
            <div class="connector bottom"></div>
          </div>
          <div class="match-wrapper">
            <div class="match" data-match-id="7" data-match-type="quarterfinal" data-position="3">
              <div class="team" data-team-id="5">
                <div class="team-name"><div class="team-logo"></div>ESPAS-ESTICE</div>
                <div class="score">-</div>
              </div>
              <div class="team" data-team-id="6">
                <div class="team-name"><div class="team-logo"></div>IESEG</div>
                <div class="score">-</div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
            </div>
            <div class="connector top"></div>
          </div>
          <div class="match-wrapper">
            <div class="match" data-match-id="8" data-match-type="quarterfinal" data-position="4">
              <div class="team" data-team-id="7">
                <div class="team-name"><div class="team-logo"></div>ESPOL</div>
                <div class="score">-</div>
              </div>
              <div class="team" data-team-id="8">
                <div class="team-name"><div class="team-logo"></div>FLD</div>
                <div class="score">-</div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
            </div>
            <div class="connector bottom"></div>
          </div>
        </div>
        <!-- Demi-finales -->
        <div class="round2">
          <div class="round-title">Demi-finales</div>
          <div class="match-wrapper">
            <div class="match" data-match-id="12" data-match-type="semifinal" data-position="1">
              <div class="team">
                <div class="team-name">-</div>
                <div class="score">0</div>
              </div>
              <div class="team">
                <div class="team-name">-</div>
                <div class="score">0</div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
            </div>
            <div class="connector top"></div>
          </div>
          <div class="match-wrapper">
            <div class="match" data-match-id="13" data-match-type="semifinal" data-position="2">
              <div class="team">
                <div class="team-name">-</div>
                <div class="score">0</div>
              </div>
              <div class="team">
                <div class="team-name">-</div>
                <div class="score">0</div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
            </div>
            <div class="connector bottom"></div>
          </div>
        </div>
        <!-- Finale & Petite Finale -->
        <div class="round3">
          <div class="round-title">Finale</div>
          <div class="match-wrapper">
            <div class="match" data-match-id="15" data-match-type="final" data-position="1">
              <div class="team">
                <div class="team-name">-</div>
                <div class="score">0</div>
              </div>
              <div class="team">
                <div class="team-name">-</div>
                <div class="score">0</div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
            </div>
          </div>
          <div class="small-final">
            <div class="small-final-title">Match pour la 3ème place</div>
            <div class="match" data-match-id="14" data-match-type="smallfinal" data-position="1">
              <div class="team">
                <div class="team-name">-</div>
                <div class="score">0</div>
              </div>
              <div class="team">
                <div class="team-name">-</div>
                <div class="score">0</div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Champion -->
        <div class="round4">
          <div class="round-title">Champion</div>
          <div class="trophy">
            <div class="trophy-icon">🏆</div>
            <div class="champion" id="champion">À déterminer</div>
          </div>
        </div>
      </div>

      <!-- SECTION MATCHS DE CLASSEMENT -->
      <div class="bracket phase-content" id="classification-phase">
        <div class="classification-container">
          <!-- Demi-finales de classement (entre perdants des quarts) -->
          <div class="round">
            <div class="round-title">Demi-finales de classement</div>
            <div class="match-wrapper">
              <div class="match" data-match-id="9" data-match-type="classification_semifinal">
                <div class="team"><div class="team-name">Perdant QF1</div><div class="score">-</div></div>
                <div class="team"><div class="team-name">Perdant QF2</div><div class="score">-</div></div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
              <div class="connector top"></div>
            </div>
            <div class="match-wrapper">
              <div class="match" data-match-id="10" data-match-type="classification_semifinal">
                <div class="team"><div class="team-name">Perdant QF3</div><div class="score">-</div></div>
                <div class="team"><div class="team-name">Perdant QF4</div><div class="score">-</div></div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
              <div class="connector bottom"></div>
            </div>
          </div>
          <!-- Match pour la 5ème place -->
          <div class="round">
            <div class="round-title">5ème - 6ème places</div>
            <div class="match-wrapper">
              <div class="match" data-match-id="11" data-match-type="classification_final">
                <div class="team"><div class="team-name">Vainqueur SF1</div><div class="score">-</div></div>
                <div class="team"><div class="team-name">Vainqueur SF2</div><div class="score">-</div></div>
              </div>
              <div class="match-info-container">
                <div class="match-time">17:45</div>
                <div class="match-status">à venir</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SECTION CLASSEMENT FINAL -->
      <div class="bracket phase-content" id="ranking-phase">
        <div class="ranking-container">
          <div class="round-title">Classement Final</div>
          <div class="ranking-table">
            <div class="ranking-row header">
              <div class="rank">Position</div>
              <div class="teamname">Équipe</div>
              <div class="points">Points</div>
            </div>
            <div id="rankingList">
              <!-- Rempli dynamiquement par JavaScript -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div style="text-align: center;">
      <button class="reset-button" id="resetTournament" onclick="resetTournament()">Réinitialiser le tournoi</button>
      <button onclick="simulateTournament()">Simuler la compétition</button>
      <button class="back-button" onclick="window.location.href='../index.html'">Retour</button>
    </div>
  </div>
  
  <!-- Ajouter avant les autres scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="tournament.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const phaseSelect = document.getElementById('phaseSelect');
      const phaseContents = document.querySelectorAll('.phase-content');
      
      phaseSelect.addEventListener('change', function() {
        const selectedPhase = phaseSelect.value;
        phaseContents.forEach(function(content) {
          // Utilisation de la classe CSS 'hidden' pour masquer/afficher
          if (content.id === selectedPhase + '-phase') {
            content.classList.remove('hidden');
          } else {
            content.classList.add('hidden');
          }
        });
        if (selectedPhase === 'ranking') {
          updateRankingDisplay();
        }
      });
      
      // Affichage initial (la phase sélectionnée dans le menu est affichée)
      phaseSelect.dispatchEvent(new Event('change'));
      
      // Vérifiez s'il y a un match en cours
      checkForLiveMatches();
      
      // Vérifier toutes les 10 secondes s'il y a un match en direct
      setInterval(checkForLiveMatches, 10000);
    });
    
    // Fonction pour vérifier s'il y a des matchs en cours
    function checkForLiveMatches() {
      const liveData = JSON.parse(localStorage.getItem('liveMatchData') || '{}');
      const liveIndicator = document.getElementById('liveIndicator');
      
      if (liveData && liveData.matchId) {
        const lastUpdateTime = new Date(liveData.lastUpdate || 0);
        const currentTime = new Date();
        const timeDiff = currentTime - lastUpdateTime;
        
        // Si la dernière mise à jour est récente (moins de 2 minutes)
        if (timeDiff < 120000) {
          liveIndicator.style.display = 'block';
          liveIndicator.innerHTML = `
            Match en direct: ${liveData.team1 || 'Équipe A'} ${liveData.score1 || '0'} - ${liveData.score2 || '0'} ${liveData.team2 || 'Équipe B'}
            <span style="font-size: 0.8em; margin-left: 10px;">${liveData.chrono || '00:00'}</span>
          `;
          
          // Surbriller le match en cours dans le tableau
          const matchElement = document.querySelector(`.match[data-match-id='${liveData.matchId}']`);
          if (matchElement) {
            matchElement.classList.add('en-cours');
            matchElement.style.boxShadow = '0 0 15px rgba(255, 152, 0, 0.7)';
          }
        } else {
          liveIndicator.style.display = 'none';
        }
      } else {
        liveIndicator.style.display = 'none';
      }
    }
    
    // Écouter les événements de stockage pour les mises à jour en direct
    window.addEventListener('storage', function(e) {
      if (e.key === 'liveMatchData') {
        checkForLiveMatches();
      }
    });
  </script>
</body>
</html>
