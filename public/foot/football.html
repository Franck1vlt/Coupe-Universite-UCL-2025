<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coupe Universitaire</title>
  <link rel="stylesheet" href="styles.css">
  <script src="tournament.js"></script>
</head>
<body>
  <div class="background-lines"></div>
  
  <div class="container">
    <header>
      <div class="phase-selector">
        <select id="phaseSelect" class="phase-select">
          <option value="qualification">Qualifications</option>
          <option value="final">Phase Finale</option> <!-- Chang√© de "final-phase" √† "final" -->
          <option value="classification">Matchs de Classement</option>
          <option value="ranking">Classement Final</option>
        </select>
      </div>
      <h1>Football</h1>
      <div class="subtitle">Phase √† √©limination directe</div>
    </header>
    
    <div class="tournament-container">
      <!-- Section Qualifications -->
      <div class="bracket phase-content" id="qualification-phase">
        <div class="round qualification-round">
          <div class="round-title">Qualifications</div>
          
          <!-- Match 1 -->
          <div class="match-wrapper">
            <div class="match" data-match-id="1" data-match-type="qualification">
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>FMMS</div>
                <div class="score">5</div>
              </div>
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>USCHOOL</div>
                <div class="score">0</div>
              </div>
            </div>
            <div class="connector right"></div>
          </div>

          <!-- Match 2 -->
          <div class="match-wrapper">
            <div class="match" data-match-id="2" data-match-type="qualification">
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>ESPAS-ESTICE</div>
                <div class="score">1</div>
              </div>
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>FLSH</div>
                <div class="score">0</div>
              </div>
            </div>
            <div class="connector right"></div>
          </div>

          <!-- Match 3 -->
          <div class="match-wrapper">
            <div class="match" data-match-id="3" data-match-type="qualification">
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>JUNIA</div>
                <div class="score">1</div>
              </div>
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>ICAM</div>
                <div class="score">5</div>
              </div>
            </div>
            <div class="connector right"></div>
          </div>

          <!-- Match 4 -->
          <div class="match-wrapper">
            <div class="match" data-match-id="4" data-match-type="qualification">
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>ESPOL</div>
                <div class="score">14</div>
              </div>
              <div class="team">
                <div class="team-name"><div class="team-logo"></div>ESSLIL</div>
                <div class="score">0</div>
              </div>
            </div>
            <div class="connector right"></div>
          </div>
        </div>
      </div>

      <!-- Section Phase Finale -->
      <div class="bracket phase-content" id="final-phase">
        <!-- Quarts de finale -->
        <div class="round">
          <div class="round-title">Quarts de finale</div>
          
          <div class="match-wrapper">
            <div class="match" data-match-id="5" data-match-type="quarterfinal" data-position="1">
              <div class="team" data-team-id="1">
                <div class="team-name"><div class="team-logo"></div>ICAM</div>
                <div class="score">-</div>
              </div>
              <div class="team" data-team-id="2">
                <div class="team-name"><div class="team-logo"></div>FMMS</div>
                <div class="score">-</div>
              </div>
            </div>
            <div class="connector top"></div>
          </div>
          
          <div class="match-wrapper">
            <div class="match" data-match-id="6" data-match-type="quarterfinal" data-position="2">
              <div class="team" data-team-id="3">
                <div class="team-name"><div class="team-logo"></div>IKPO</div>
                <div class="score">-</div>
              </div>
              <div class="team" data-team-id="4">
                <div class="team-name"><div class="team-logo"></div>FGES</div>
                <div class="score">-</div>
              </div>
            </div>
            <div class="connector bottom"></div>
          </div>
          
          <div class="match-wrapper">
            <div class="match" data-match-id="7" data-match-type="quarterfinal" data-position="3">
              <div class="team" data-team-id="5">
                <div class="team-name"><div class="team-logo"></div>ESPAS-ESTICE</div>
                <div class="score">-</div>
              </div>
              <div class="team" data-team-id="6">
                <div class="team-name"><div class="team-logo"></div>ISEG</div>
                <div class="score">-</div>
              </div>
            </div>
            <div class="connector top"></div>
          </div>
          
          <div class="match-wrapper">
            <div class="match" data-match-id="8" data-match-type="quarterfinal" data-position="4">
              <div class="team" data-team-id="7">
                <div class="team-name"><div class="team-logo"></div>ESPOL</div>
                <div class="score">-</div>
              </div>
              <div class="team" data-team-id="8">
                <div class="team-name"><div class="team-logo"></div>FLD</div>
                <div class="score">-</div>
              </div>
            </div>
            <div class="connector bottom"></div>
          </div>
        </div>

        <!-- Demi-finales -->
        <div class="round2">
          <div class="round-title">Demi-finales</div>
          
          <div class="match-wrapper">
            <div class="match" data-match-id="9" data-match-type="semifinal" data-position="1">
              <div class="team">
                <div class="team-name">√Ä d√©terminer</div>
                <div class="score">-</div>
              </div>
              <div class="team">
                <div class="team-name">√Ä d√©terminer</div>
                <div class="score">-</div>
              </div>
            </div>
            <div class="connector top"></div>
          </div>
          
          <div class="match-wrapper">
            <div class="match" data-match-id="10" data-match-type="semifinal" data-position="2">
              <div class="team">
                <div class="team-name">√Ä d√©terminer</div>
                <div class="score">-</div>
              </div>
              <div class="team">
                <div class="team-name">√Ä d√©terminer</div>
                <div class="score">-</div>
              </div>
            </div>
            <div class="connector bottom"></div>
          </div>
        </div>
        
        <!-- Finale -->
        <div class="round3">
          <div class="round-title">Finale</div>
          
          <div class="match-wrapper">
            <div class="match" data-match-id="11" data-match-type="final" data-position="1">
              <div class="team">
                <div class="team-name">√Ä d√©terminer</div>
                <div class="score">-</div>
              </div>
              <div class="team">
                <div class="team-name">√Ä d√©terminer</div>
                <div class="score">-</div>
              </div>
            </div>
          </div>
          
          <!-- Petite Finale -->
          <div class="small-final">
            <div class="small-final-title">Match pour la 3√®me place</div>
            <div class="match" data-match-id="12" data-match-type="smallfinal" data-position="1">
              <div class="team">
                <div class="team-name">√Ä d√©terminer</div>
                <div class="score">-</div>
              </div>
              <div class="team">
                <div class="team-name">√Ä d√©terminer</div>
                <div class="score">-</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Champion -->
        <div class="round4">
          <div class="round-title">Champion</div>
          
          <div class="trophy">
            <div class="trophy-icon">üèÜ</div>
            <div class="champion" id="champion">√Ä d√©terminer</div>
          </div>
        </div>
      </div>

      <!-- Section Matches de Classement -->
      <div class="bracket phase-content" id="classification-phase">
        <div class="classification-container">
          <div class="round">
            <div class="round-title">5-6√®me places</div>
            <div class="match-wrapper">
              <div class="match" data-match-id="15" data-match-type="classification_final">
                <div class="team"><div class="team-name">5√®me place</div><div class="score">-</div></div>
                <div class="team"><div class="team-name">6√®me place</div><div class="score">-</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section Classement -->
      <div class="bracket phase-content" id="ranking-phase">
        <div class="ranking-container">
          <div class="round-title">Classement Final</div>
          <div class="ranking-table">
            <div class="ranking-row header">
              <div class="rank">Position</div>
              <div class="team-name">√âquipe</div>
              <div class="points">Points</div>
            </div>
            <div id="rankingList">
              <!-- Rempli dynamiquement par JavaScript -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div style="text-align: center;">
      <button class="reset-button" id="resetTournament">R√©initialiser le tournoi</button>
      <button class="back-button" onclick="window.location.href='../index.html'">Retour</button>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const phaseSelect = document.getElementById('phaseSelect');
      const phaseContents = document.querySelectorAll('.phase-content');

      phaseSelect.addEventListener('change', function() {
        const selectedPhase = phaseSelect.value;
        console.log('Selected Phase:', selectedPhase);

        phaseContents.forEach(function(content) {
          if (content.id === selectedPhase + '-phase') {
            content.style.display = 'block';
            // V√©rifier si l'√©l√©ment .bracket existe avant d'acc√©der √† son style
            const bracket = content.querySelector('.bracket');
            if (bracket && selectedPhase === 'final') {
              bracket.style.display = 'flex';
            }
          } else {
            content.style.display = 'none';
          }
        });

        if (selectedPhase === 'ranking') {
          updateRanking();
        }
      });

      // D√©finir et d√©clencher l'affichage initial
      phaseSelect.value = 'final';
      phaseSelect.dispatchEvent(new Event('change'));
    });

    function updateRanking() {
      const rankings = calculateRankings();
      const rankingList = document.getElementById('rankingList');
      rankingList.innerHTML = '';

      rankings.forEach((team, index) => {
        const position = index + 1;
        rankingList.innerHTML += `
          <div class="ranking-row ${position <= 3 ? 'highlight-' + position : ''}">
            <div class="rank">${position}</div>
            <div class="team-name">${team.name}</div>
            <div class="points">${team.points}</div>
          </div>
        `;
      });

      console.log('Updated Rankings:', rankings);
    }

    function calculateRankings() {
      let rankings = [];
      const matches = tournamentState.matches;

      // Points fixes selon la position finale
      const positionPoints = {
        1: 50,  // Champion
        2: 40,  // Finaliste
        3: 35,  // 3√®me place
        4: 30,  // 4√®me place
        5: 25,  // 5√®me place
        6: 20,  // 6√®me place
        7: 10,  // 7√®mes places (ex-aequo)
        9: 5    // 9√®mes places (perdants qualifications)
      };

      // Ajouter toutes les √©quipes
      Object.values(teams).forEach(team => {
        rankings.push({
          id: team.id,
          name: team.name,
          points: 0,
          position: null
        });
      });

      // Traiter les matches pour d√©terminer les positions
      Object.values(matches).forEach(match => {
        if (match.completed) {
          const winner = rankings.find(team => team.id === match.winner);
          const loser = rankings.find(team => team.id === match.loser);

          switch(match.matchType) {
            case 'final':
              if (winner) {
                winner.points = positionPoints[1];
                winner.position = 1;
              }
              if (loser) {
                loser.points = positionPoints[2];
                loser.position = 2;
              }
              break;

            case 'smallfinal':
              if (winner) {
                winner.points = positionPoints[3];
                winner.position = 3;
              }
              if (loser) {
                loser.points = positionPoints[4];
                loser.position = 4;
              }
              break;

            case 'classification_final':
              if (winner) {
                winner.points = positionPoints[5];
                winner.position = 5;
              }
              if (loser) {
                loser.points = positionPoints[6];
                loser.position = 6;
              }
              break;

            case 'quarterfinal':
              if (loser) {
                loser.points = positionPoints[7];
                loser.position = 7;
              }
              break;

            case 'qualification':
              if (loser) {
                loser.points = positionPoints[9];
                loser.position = 9;
              }
              break;
          }
        }
      });

      // Trier le classement
      rankings.sort((a, b) => a.position - b.position);

      console.log('Calculated Rankings:', rankings);
      return rankings;
    }
  </script>
</body>
</html>