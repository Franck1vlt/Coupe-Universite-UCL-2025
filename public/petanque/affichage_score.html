<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Affichage Score Pétanque</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #ffffff;
            color: #000000;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        .score-board {
            text-align: center;
            width: 100%;
            padding: 1.25rem;
        }

        .teams {
            display: flex;
            justify-content: space-around;
            font-size: 5rem;
            margin: 1.25rem 0;
            font-weight: bold;
        }

        .score-container {
            font-size: 12rem;
            font-weight: bold;
            margin: 2.5rem 0;
        }

        img#ballIconA {}

        .ball-icon {
            width: 3rem;
            height: 3rem;
            vertical-align: middle;
        }

        .ball-icon-table {
            width: 1.25rem;
            height: 1.25rem;
            margin-right: 1.25rem;
            margin-left: 1.25rem;
        }

        .score-divider {
            margin: 0 2.5rem;
            color: #000000;
        }

        .match-info {
            font-size: 3rem;
            margin: 1.875rem 0;
        }

        .remaining-time {
            background-color: #000000;
            padding: 0.625rem 1.25rem;
            border-radius: 0.625rem;
            margin-right: 1.25rem;
            color: red
        }

        .match-type {
            color: #000000;
        }

        .team-logo {
            width: 5rem;
            height: 5rem;
            margin: 0 1.25rem;
            object-fit: contain;
        }

        /* Animation pour les changements de score */
        .score-change {
            animation: scoreUpdate 0.5s ease-in-out;
        }

        @keyframes scoreUpdate {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* Styles pour le mode split-screen */
        @media (max-width: 600px) {
            .teams {
                font-size: 3rem;
            }
            
            .score-container {
                font-size: 8rem;
            }
            
            .match-info {
                font-size: 2rem;
            }
            
            .ball-icon {
                width: 2rem;
                height: 2rem;
            }
            
            .team-logo {
                width: 4rem;
                height: 4rem;
            }
        }
    </style>
</head>
<body>
    <div class="score-board">
        <div class="teams">
            <div class="team">
                <img src="" alt="" class="team-logo" id="logoB">
                <div id="teamBName">TEAM B</div>
            </div>
            <div class="team">
                <img src="" alt="" class="team-logo" id="logoA">
                <div id="teamAName">TEAM A</div>
            </div>
        </div>
        
        <div class="score-container">
            <img src="cochonnet.png" class="ball-icon" id="ballIconB" style="visibility: hidden;">
            <span id="teamBScore">0</span>
            <span class="score-divider">-</span>
            <span id="teamAScore">0</span>
            <img src="cochonnet.png" class="ball-icon" id="ballIconA" style="visibility: hidden;">
        </div>
        
        <div class="match-info">
            <span class="remaining-time" id="gameChrono">00:00</span>
            <span class="match-type" id="matchType"></span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifier si on est dans une iframe (pour le split screen)
            const isInIframe = window.location !== window.parent.location;
            
            // Obtenir l'ID de l'iframe ou utiliser le paramètre 'match' de l'URL
            const urlParams = new URLSearchParams(window.location.search);
            const matchParam = urlParams.get('match');
            const iframeId = isInIframe ? (window.name || `match${matchParam}`) : '';
            
            console.log(`Mode: ${isInIframe ? 'iframe' : 'standalone'}, ID: ${iframeId}, Match: ${matchParam}`);
            
            // À ajouter dans le script d'affichage_score.html
            // Remplacer la fonction updateDisplay() existante par celle-ci

            function updateDisplay() {
                console.log("Mise à jour de l'affichage...");
                
                // Choisir la source des données en fonction du contexte
                let matchData;
                const isInIframe = window.location !== window.parent.location;
                const urlParams = new URLSearchParams(window.location.search);
                const matchParam = urlParams.get('match');
                const iframeId = isInIframe ? (window.name || `match${matchParam}`) : '';
                
                let dataSource = '';
                
                if (isInIframe && iframeId) {
                    // Mode iframe: utiliser les données spécifiques à cette iframe
                    const storedData = localStorage.getItem(`liveMatchData_${iframeId}`);
                    matchData = JSON.parse(storedData || '{}');
                    dataSource = `liveMatchData_${iframeId}`;
                } else if (matchParam) {
                    // Mode URL avec paramètre match: utiliser les données spécifiques à ce match
                    matchData = JSON.parse(localStorage.getItem(`liveMatchData_match${matchParam}`) || '{}');
                    dataSource = `liveMatchData_match${matchParam}`;
                } else {
                    // Mode autonome standard: utiliser les données standards
                    matchData = JSON.parse(localStorage.getItem('liveMatchData') || '{}');
                    dataSource = 'liveMatchData';
                }
                
                console.log(`Source des données: ${dataSource}`, matchData);
                
                // Mise à jour des équipes et du type de match
                const teamAName = document.getElementById('teamAName');
                const teamBName = document.getElementById('teamBName');
                const matchType = document.getElementById('matchType');
                
                // Vérification et débogage des noms d'équipes
                console.log("Noms d'équipes reçus:", {
                    team1: matchData.team1,
                    team2: matchData.team2
                });
                
                if (teamAName) {
                    teamAName.textContent = matchData.team1 || 'TEAM A';
                    console.log(`Nom d'équipe A défini à: ${teamAName.textContent}`);
                }
                
                if (teamBName) {
                    teamBName.textContent = matchData.team2 || 'TEAM B';
                    console.log(`Nom d'équipe B défini à: ${teamBName.textContent}`);
                }
                
                if (matchType) {
                    matchType.textContent = matchData.matchType || 'Match en cours';
                }
                
                // Correction des chemins des logos
                const logoA = document.getElementById('logoA');
                const logoB = document.getElementById('logoB');
                
                if (logoA && matchData.team1) {
                    logoA.src = `../img/${matchData.team1}.png`;
                    logoA.onerror = () => {
                        console.log(`Logo non trouvé pour ${matchData.team1}, utilisation du logo par défaut`);
                        logoA.src = '../img/default.png';
                    };
                }
                
                if (logoB && matchData.team2) {
                    logoB.src = `../img/${matchData.team2}.png`;
                    logoB.onerror = () => {
                        console.log(`Logo non trouvé pour ${matchData.team2}, utilisation du logo par défaut`);
                        logoB.src = '../img/default.png';
                    };
                }
                
                // Mise à jour des scores
                const teamAScore = document.getElementById('teamAScore');
                const teamBScore = document.getElementById('teamBScore');
                
                if (teamAScore) teamAScore.textContent = matchData.score1 || '0';
                if (teamBScore) teamBScore.textContent = matchData.score2 || '0';
                
                // Mise à jour du chronomètre
                const gameChrono = document.getElementById('gameChrono');
                if (gameChrono) gameChrono.textContent = matchData.chrono || '00:00';

                // Mise à jour du serveur
                const ballIconA = document.getElementById('ballIconA');
                const ballIconB = document.getElementById('ballIconB');
                
                if (ballIconA && ballIconB) {
                    if (matchData.server === 'A') {
                        ballIconA.style.visibility = 'visible';
                        ballIconB.style.visibility = 'hidden';
                    } else if (matchData.server === 'B') {
                        ballIconA.style.visibility = 'hidden';
                        ballIconB.style.visibility = 'visible';
                    } else {
                        // Si pas de serveur défini, cacher les deux
                        ballIconA.style.visibility = 'hidden';
                        ballIconB.style.visibility = 'hidden';
                    }
                }
            }
            // Mise à jour initiale
            updateDisplay();

            // Mise à jour toutes les 100ms
            setInterval(updateDisplay, 100);
            
            // Écouter les messages du parent pour le mode iframe
            window.addEventListener('message', function(event) {
                if (event.data.type === 'updateMatchData') {
                    console.log(`Réception de mise à jour pour ${iframeId}:`, event.data.data);
                    
                    const storageKey = isInIframe ? `liveMatchData_${iframeId}` : 'liveMatchData';
                    localStorage.setItem(storageKey, JSON.stringify(event.data.data));
                    
                    updateDisplay();
                }
            });
        });
    </script>
</body>
</html>